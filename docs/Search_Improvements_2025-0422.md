# 検索機能改善状況 (2025-04-22)

## 1. 現状ステータス

- **検索機能の改善**
    - **対応済みクエリタイプ:**
        - 営業時間関連
        - 予約変更関連
        - 荷物関連 (サイズ、個数含む)
        - ひとり送迎関連 (6名以上、複数台含む)
        - 満車関連 (軽自動車対応、空き/通知含む)
        - アクセス関連 (基本的な経路)
    - **実装済み機能:**
        - `searchKnowledge` 関数の全体的な改良
        - Kuromojiによる形態素解析と重要語抽出
        - ストップワード除去
        - PGroongaクエリの最適化 (重み付け、各種ボーナス)
        - スコアリングロジックの強化
            - 特定IDへのスコアブースト (例: ID 113, 21, 28-32, 48, 100-107, 170-174)
            - カテゴリマッピング (`CATEGORY_QUERY_MAPPING`) の活用
            - 特定キーワード検出関数 (`isXxxQuery`) の導入とスコアリングへの反映
            - 質問と回答の類似度、単語一致率の考慮
        - キャッシュ機能 (`searchCache`, `CACHE_TTL`, `MAX_CACHE_ENTRIES`)
        - パフォーマンスメトリクス (`searchMetrics`)
        - シンプル検索へのフォールバック (`simpleSearch`)
- **テスト**
    - `src/scripts/simple-search-test.ts` を拡張
        - 各種カテゴリのテストクエリを追加 (営業時間、予約変更、荷物、ひとり送迎、満車、アクセス、その他一般)
        - 結果の検証ロジックを追加 (期待されるIDやカテゴリとの比較)
    - **テスト結果:**
        - 多くのクエリで改善が見られる
        - 特定のクエリタイプではまだ改善の余地あり (下記「実装予定」参照)

## 2. 実装予定 (今後の改善点)

- **検索精度向上 (特定クエリへの対応強化)**
    - **「送迎が必要ない場合の利用プランは？」**
        - **課題:** 関連性の低い結果 (ID 110: 車両保険) が返される
        - **対応:**
            - 関連ナレッジの確認・追加 (例: 「送迎なしプラン」)
            - スコアリング調整: `search.ts` にて、「送迎」＋「不要」「なし」などのキーワードがある場合に、該当ナレッジIDのスコアをブースト
    - **「繁忙期の利用制限」「繁忙期の予約のコツ」**
        - **課題:** 関連性は高いが、より直接的な回答が望ましい (現状 ID 89, 19 がヒット)
        - **対応:**
            - 関連ナレッジの確認・追加 (例: 繁忙期の具体的制限、予約のコツ)
            - スコアリング調整: `search.ts` にて、「繁忙期」キーワードを含むクエリの場合に、該当ナレッジIDのスコアをブースト
    - **「最寄り駅からの移動手段」**
        - **課題:** アクセス関連IDが一律にブーストされ、首都高アクセス (ID 104) が上位に来てしまう
        - **対応:**
            - スコアリング調整: `search.ts` のアクセス関連スコアリングを詳細化
                - 「最寄り駅」「駅」「電車」「バス」「公共交通機関」等のキーワードに応じて、ID 101 (電車・モノレール), ID 102 (バス・タクシー) のスコアを特にブースト
- **その他**
    - ナレッジベース自体の拡充 (不足している情報、表現の追加)
    - スコアリングパラメータ (WEIGHTS, POS_WEIGHTS 等) の継続的な微調整
    - テストケースのさらなる追加・網羅性向上 