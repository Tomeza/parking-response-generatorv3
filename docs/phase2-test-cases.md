# Phase2 テストケース定義

## 概要

Phase2の受け入れ回し機能を含むルーティングシステムの品質を検証するためのテストケース定義です。

## テストケース一覧

### 1. 予約変更（通常）
- **クエリ**: "駐車場の予約を変更したいのですが"
- **期待値**: 
  - category: `reservation`
  - intent: `modify`
  - tone: `normal`
- **意味論**: 予約の変更を求める一般的な問い合わせ
- **期待動作**: 厳格フィルタでマッチ、人間確認不要

### 2. 緊急キャンセル
- **クエリ**: "緊急で駐車場の予約をキャンセルしたい"
- **期待値**: 
  - category: `reservation`
  - intent: `cancel`
  - tone: `urgent`
- **意味論**: 緊急性を伴う予約キャンセル要求
- **期待動作**: 部分マッチ（tone不一致）、人間確認必要

### 3. 送迎時間問い合わせ
- **クエリ**: "送迎サービスの時間を教えてください"
- **期待値**: 
  - category: `shuttle`
  - intent: `inquiry`
  - tone: `normal`
- **意味論**: 情報提供を求める一般的な問い合わせ（`inquiry`が妥当）
- **期待動作**: 厳格フィルタでマッチ、低リスク自動通過

### 4. 支払い方法詳細
- **クエリ**: "支払い方法について詳しく知りたい"
- **期待値**: 
  - category: `payment`
  - intent: `inquiry`
  - tone: `normal`
- **意味論**: 詳細情報を求める問い合わせ
- **期待動作**: 厳格フィルタでマッチ、低リスク自動通過

### 5. 事故報告
- **クエリ**: "駐車場で事故が起きました"
- **期待値**: 
  - category: `trouble`
  - intent: `report`
  - tone: `urgent`
- **意味論**: 緊急事態の報告
- **期待動作**: 厳格フィルタでマッチ、人間確認不要

## 意図分類の境界

### `check` vs `inquiry` の区別

#### `check`（確認・照会）
- **キーワード**: 確認、ありますか、できますか、時間、料金、予約状況
- **特徴**: 既存の状態や可能性を確認する
- **例**: "予約はありますか？"、"料金はいくらですか？"

#### `inquiry`（問い合わせ）
- **キーワード**: 教えて、詳しく、方法、手順、どうやって
- **特徴**: 情報提供や手順を求める
- **例**: "時間を教えてください"、"方法について詳しく知りたい"

## 品質指標

### 目標値
- **直撃率**: 80%以上
- **補正率**: 20%以下
- **成功率**: 100%（テストケース）

### 測定方法
- **直撃率**: 厳格フィルタでのマッチ率
- **補正率**: 人間確認が必要なケースの割合
- **成功率**: 期待値と実際の解析結果の一致率

## 決定規則

### タイブレーク順序
1. `usageLabel`（◯/△/✖️）
2. `updated_at`（最新）
3. `id`（昇順）

### 人間確認判定
1. 信頼度 < 0.6
2. 厳格フィルタでマッチしない
3. 代替候補 < 2件
4. 緊急度 = 'high' かつ緊急タグあり

### 低リスク自動通過
1. 通常の問い合わせ（tone = 'normal' かつ urgency = 'low'）
2. 一般的な情報確認（intent = 'check' かつ category ≠ 'trouble'）
3. 標準的な対応タグあり 