# Embedding Dimension Comparison Strategy (512 vs 1536)

## 文脈と前提

*   いまは512次元 (`text-embedding-3-small`) で埋め込みを生成し、ハイブリッド検索＋RAGで精度0.93を達成済み。
*   「1536次元に切り替えて比較検討する」こと自体を、果たして意味ある投資かどうか悩まれている。

---

## ① なぜ "512 vs 1536" を試すのか？

1.  **潜在的精度向上**
    *   高次元 embedding は「より微細な意味差」を捉えやすく、曖昧クエリや複雑意図の回答精度向上に貢献する可能性がある。
2.  **コスト／レイテンシのトレードオフ**
    *   次元数増加 → APIコスト↑、検索レイテンシ↑ のペナルティ。
3.  **意思決定のエビデンス**
    *   定量データ（Recall@1, Recall@5, 平均応答時間, API費用）をもとに最適解を選ぶため。

---

## ② "単純に1536を試す" が短絡的になりうるケース

*   **本番規模の全データで一括実施**
    → コスト／時間が膨大になり、ROI がマイナスになる恐れ。
*   **精度差が微小なのに切り替えてしまう**
    → 運用複雑化だけが増え、メリットが見えにくい。
*   **他の改善余地（プロンプト設計や再ランカー）が先にある**
    → 埋め込み次元以外の要因で精度改善余地が大きい可能性。

---

## ③ 賢い「1536次元テスト」の進め方

1.  **代表クエリのサンプルセットを用意**
    *   10〜20件程度の「曖昧 or 難易度高め」な質問をピックアップ。
2.  **スモールスケールで埋め込み再生成**
    *   そのサンプルだけを `text-embedding-3` （1536次元）で埋め込み直し。
3.  **短期ベンチマーク**
    *   512 vs 1536 で Top-1 正解率 / Recall@5 / 平均検索時間 / APIコスト を比較。
4.  **意思決定マトリクス**

    | 指標                  | 512 次元 | 1536 次元 | コメント          |
    | ------------------- | ------ | ------- | ------------- |
    | Top-1 正解率           | 93.3%  | 94.0%   | +0.7pt の価値あり？ |
    | Recall@5           | 98.0%  | 98.5%   | 微小差なら見送りも検討   |
    | 平均検索レイテンシ (ms)      | 50     | 120     | ユーザー許容内か？     |
    | APIコスト (¥/1000 req) | ¥2.0   | ¥6.5    | 年間利用量で何十万円差？  |
5.  **ROI 評価**
    *   精度向上のビジネス価値 vs コスト増・レイテンシ悪化を定量化し、切り替え可否を判断。

---

## ④ まとめ：試す価値はあるが「段階的かつ定量的」に

1.  **短絡的ではない**――正しく設計すれば有意義な AB テストになる。
2.  **全データ一括ではなく、サンプルセットでまず検証**。
3.  **結果を具体的な数値で比較し、ROI マトリクスで最終判断**。

---

> **キーテイクアウェイ**
>
> *   "512 vs 1536" 比較は、**代表クエリに絞ったスモールテスト**から始める
> *   定量データをもとに、**速度・コスト・精度のトレードオフ**を可視化
> *   "劇的改善"がなければ512継続、あれば1536本番移行

この流れで進めると、無駄な工数を抑えつつ、科学的に最適解を導くことができます。 