---
slug: implementation-core-concepts
title: 実装コアコンセプト：センシング精度とルーティング精度の最適化（2025年7月29日）
created: 2025-07-29
project: parking-response-generator
purpose: センシング精度とルーティング精度の最適化に関する実装コンセプトの整理
reason: 2025年10-12月の「センスの良し悪しでAGIの差が顕在化」に向けた準備
status: planning
tags: 
  - センシング
  - ルーティング
  - テンプレート管理
  - 品質指標
  - 運用設計
implemented: false
priority: high
last_verified: 2025-07-29
---

# 実装コアコンセプト：センシング精度とルーティング精度の最適化

## 1) 先生の要点（平易な再要約）

### 勝敗を分けるポイント
- "出力の正確性"だけでなく、"センシング（察する力）"の正確性
- 「相手が何を望むか」をつかむ精度が肝

### センシング精度の向上
- **センシング精度を上げるコアが"ルーティング"**
- 三段モデル：①センシング→②ルーティング→③実行
- 中核はルーティング精度

### 知識層の設計
- ベクトルだけに依存しない
- 高品質テキスト層（構造化テンプレ／方針文）の重要性
- 「テキスト・レイヤー」の台頭

### 時期的な展望
- 2025年10月以降：多数の"自律するがセンスの悪いAGI"の出現
- 差別化は**センス×精度**で決定的に

### 進化段階
1. **推論型センシング**（相手のニーズを推測）：現実解（2025-2026年）
2. **同期型センシング**（相手ニーズとリアルタイム同調）：将来像

## 2) 設計への翻訳（メール返信アプリ向け）

### 三段モデルの実装

#### 1. センシング（Sensing）
- 意図・カテゴリ・緊急度・相手の"好み/方針"を推論
  - 例：Billing/Complaint、丁寧度、禁則
- データ源
  - メール本文
  - 相手/案件プロファイル（会社ポリシー、口調、NG文言等）

#### 2. ルーティング（Routing）
- センシング結果を**テンプレ／FAQ／方針文**に最短接続
- 検索戦略
  1. 厳格フィルタ（カテゴリ/intent）
  2. 必要に応じてベクトル補助でTop-k

#### 3. 実行（Acting）
- テンプレ処理
  - 変数差し込み
  - 必要部分のみLLM整形
- UI/フィードバック
  - 候補をUI提示（人手で補正可能）
  - 確定後の学習（頻度 +1、プロファイル更新）

### データ層の設計方針

#### 高品質テキスト層（Supabase）
- コンテンツ
  - 会社方針
  - 法務定型
  - 謝罪/依頼の雛形
  - 差し込み変数の仕様書
- 品質管理
  - 改版履歴
  - 審査済みフラグ
  - そのまま読んでも意味が通る品質維持

#### ベクトル層の位置づけ
- 補助的役割（曖昧照合や意図拡張）
- 常に厳格フィルタを優先
  1. カテゴリ/intentによるフィルタ
  2. ベクトル検索による補完

## 3) 受け入れ基準（2025年10月までの目標）

### 定量的指標
- テンプレ直撃率 ≥ 70%（候補表示後の1位確定割合）
- 人手補正率 ≤ 15%（カテゴリ/intent再選択が必要な割合）
- フォールバック比率 ≤ 20%（未ヒットでベクトル補助に落ちる割合）
- 編集距離：中央値を最小化（文体整形に留める）
- p95レイテンシ < 1.5s（センシング→候補表示）

### スコアリング式

```typescript
// 候補ランキングのスコア計算
score = 0.45 * intent_match        // 完全一致:1, 近似:0.5, なし:0
      + 0.25 * importance_norm     // 0..1
      + 0.15 * frequency_norm      // 0..1（対数正規化推奨）
      + 0.10 * preference_fit      // 相手/ブランドの口調一致度 0..1
      + 0.05 * recency_norm;       // 更新の新しさ 0..1
```

## 4) リスク管理と回避策

### センシング/ルーティング系リスク

#### 1. 意図粒度の不適切さ
- *兆候*: 直撃率低下またはテンプレ乱立
- *回避策*:
  - 代表3-5カテゴリ × intentを業務語彙で固定
  - 週次での棚卸し実施

#### 2. ベクトル依存度の過剰
- *兆候*: 類似だが不適切な候補の出現
- *回避策*:
  - 厳格フィルタを優先
  - UI選択結果の頻度学習

#### 3. LLMの逸脱
- *回避策*:
  - 厳格なシステムプロンプト
  - 差分ログによる監視
  - テンプレート本文の不変性確保

### データ/運用系リスク

#### 4. テキスト品質の劣化
- *回避策*:
  - 命名規約の整備
  - 承認フラグの運用
  - 定期的な棚卸し
  - アーカイブ戦略

#### 5. 改善サイクルの停滞
- *回避策*:
  - 初期からのログ収集
  - 主要メトリクスの定期確認

#### 6. 頻度バイアス
- *回避策*:
  - 合成スコアの導入
  - 定期的な重要度再評価

## 5) 明日のアクションアイテム

### 1. テキスト層の基盤構築
- 審査済みテンプレート10件の作成
  - `Billing / due_date / tone:polite` など
  - 品質基準の確立

### 2. ルーティング基盤の実装
- Adapter関数の作成
- 厳格クエリの実装
- 優先順位付けロジックの組み込み

### 3. UI/フィードバックの初期実装
- 候補3件表示の暫定UI
- 選択→頻度更新の実装

### 4. モニタリング基盤の準備
- 基本ログの収集開始
  - ルーティング結果
  - クエリパラメータ
  - 選択結果
  - レイテンシ

## まとめ

### コアコンセプト
- センシング精度＝ルーティング精度
- 高品質テキスト層の重要性
- ベクトル検索は補助的役割

### 実装の要点
- 厳格フィルタを基本とする
- 高品質テンプレートの維持
- 継続的な改善サイクル

### 成功指標
- 直撃率
- 補正率
- レイテンシ

これらの指標を2025年10月までに目標値に到達させることで、「センスの良い」システムを実現します。 